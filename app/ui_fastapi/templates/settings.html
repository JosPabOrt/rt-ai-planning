<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Halcyon QA ‚Äì Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>
<body>
<div class="page">

    <!-- CABECERA -->
    <header class="header">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 8px;">
            <div>
            <h1>Halcyon QA ‚Äì Panel</h1>  <!-- o Settings -->
            <p class="subtitle">Prototype ¬∑ FastAPI</p>
            </div>
            <button id="theme_toggle" type="button" class="btn-ghost">
            üåô Dark mode
            </button>
        </div>

        <nav class="nav-tabs">
            <a href="/" class="nav-tab {% if active_tab == 'panel' %}nav-tab-active{% endif %}">Panel</a>
            <a href="/settings" class="nav-tab {% if active_tab == 'settings' %}nav-tab-active{% endif %}">Settings</a>
        </nav>
    </header>

    <!-- aqu√≠ el resto de tu contenido de settings -->
    {% if error %}
        <div class="alert alert-error">
        <strong>Error:</strong> {{ error }}
        </div>
    {% endif %}

    <section class="card">
        <h2>Configuraci√≥n de QA</h2>
        <!-- ‚Ä¶ tu formulario/JSON/lo que ya tengas ‚Ä¶ -->
    </section>

    </div>

    <!-- reutiliza el mismo script de theme_toggle que tienes en index.html -->
    <script>
    (function () {
        const toggle = document.getElementById('theme_toggle');
        const body   = document.body;
        const stored = window.localStorage.getItem('qa_theme');
        if (stored === 'dark') {
            body.classList.add('theme-dark');
            if (toggle) toggle.textContent = '‚òÄÔ∏è Light mode';
        }
        if (toggle) {
            toggle.addEventListener('click', function () {
                const isDark = body.classList.toggle('theme-dark');
                window.localStorage.setItem('qa_theme', isDark ? 'dark' : 'light');
                toggle.textContent = isDark ? '‚òÄÔ∏è Light mode' : 'üåô Dark mode';
            });
        }
    })();
    </script>

        <!-- Selector de site / clinic (GET) -->
        <form method="get" action="/settings" class="run-form" style="margin-top:12px;">
            <div class="form-row">
                <label for="site">Site cl√≠nico</label>
                <input
                    type="text"
                    id="site"
                    name="site"
                    value="{{ site or ui_config.site or '' }}"
                    placeholder="PROSTATE, HEADNECK, etc."
                    required
                >
            </div>
            <div class="form-row">
                <label for="clinic_id">Perfil de cl√≠nica</label>
                <input
                    type="text"
                    id="clinic_id"
                    name="clinic_id"
                    value="{{ clinic_id or ui_config.clinic_id or 'DEFAULT' }}"
                    placeholder="DEFAULT u otro ID de cl√≠nica"
                    required
                >
            </div>
            <button type="submit" class="btn-primary">Cargar configuraci√≥n</button>
        </form>
    </header>

    <!-- INFO GLOBAL -->
    <section class="card summary-card">
        <h2>Resumen de configuraci√≥n actual</h2>
        <div class="summary-grid">
            <div>
                <div class="summary-label">Site</div>
                <div class="summary-value">{{ ui_config.site }}</div>
            </div>
            <div>
                <div class="summary-label">Perfil de cl√≠nica</div>
                <div class="summary-value">{{ ui_config.clinic_id }}</div>
            </div>
            <div>
                <div class="summary-label">Secciones</div>
                <div class="summary-value">
                    {{ ui_config.sections | length }}
                </div>
            </div>
            <div class="summary-mini">
                <div class="summary-label">Nota</div>
                <div class="summary-badges">
                    <span class="badge badge-warn">
                        Esta UI a√∫n no guarda cambios (solo vista/maqueta)
                    </span>
                </div>
            </div>
        </div>
    </section>

    <!-- PESTA√ëAS DE SECCIONES -->
    <section class="card">
        <h2>Configuraci√≥n por secci√≥n</h2>

        <!-- Tabs -->
        <div class="tabs-header" style="display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px;">
            {% for section in ui_config.sections %}
                <button
                    type="button"
                    class="btn-ghost tab-btn"
                    data-tab-target="section-{{ section.id }}"
                >
                    {{ section.label or section.id }}
                </button>
            {% endfor %}
        </div>

        <!-- Contenido de cada secci√≥n -->
        <div class="tabs-content">
            {% for section in ui_config.sections %}
                <div
                    id="section-{{ section.id }}"
                    class="settings-section"
                    style="display: none;"
                >
                    <!-- Encabezado de secci√≥n -->
                    <div class="card" style="margin-bottom:12px;">
                        <h3 style="margin-top:0;">
                            {{ section.label or section.id }}
                        </h3>

                        <div class="summary-grid">
                            <div>
                                <div class="summary-label">ID secci√≥n</div>
                                <div class="summary-value">{{ section.id }}</div>
                            </div>
                            <div>
                                <div class="summary-label">Enabled</div>
                                <div class="summary-value">
                                    <label style="display:flex; align-items:center; gap:4px;">
                                        <input
                                            type="checkbox"
                                            name="section_enabled_{{ section.id }}"
                                            {% if section.enabled %}checked{% endif %}
                                        >
                                        <span>Activar secci√≥n</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div class="summary-label">Peso secci√≥n</div>
                                <div class="summary-value" style="display:flex; align-items:center; gap:8px;">
                                    <input
                                        type="range"
                                        min="0.0"
                                        max="3.0"
                                        step="0.1"
                                        name="section_weight_{{ section.id }}"
                                        value="{{ section.weight or 1.0 }}"
                                        oninput="this.nextElementSibling.textContent = this.value"
                                    >
                                    <span>{{ section.weight or 1.0 }}</span>
                                </div>
                            </div>
                            <div>
                                <div class="summary-label">Checks en secci√≥n</div>
                                <div class="summary-value">
                                    {{ section.checks | length }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de checks de la secci√≥n -->
                    <div class="card">
                        <h4 style="margin-top:0;">Checks individuales</h4>
                        <table class="qa-table">
                            <thead>
                            <tr>
                                <th>Check</th>
                                <th>Enabled</th>
                                <th>Peso</th>
                                <th>Descripci√≥n</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for chk in section.checks %}
                                <tr>
                                    <td>
                                        <strong>{{ chk.label or chk.id }}</strong><br>
                                        <code style="font-size:0.75rem;">{{ chk.id }}</code>
                                    </td>
                                    <td style="text-align:center;">
                                        <input
                                            type="checkbox"
                                            name="check_enabled_{{ section.id }}_{{ chk.id }}"
                                            {% if chk.enabled %}checked{% endif %}
                                        >
                                    </td>
                                    <td style="min-width:120px;">
                                        <input
                                            type="number"
                                            name="check_weight_{{ section.id }}_{{ chk.id }}"
                                            value="{{ chk.weight or 1.0 }}"
                                            step="0.1"
                                            min="0.0"
                                            max="5.0"
                                            style="width:80px;"
                                        >
                                    </td>
                                    <td>
                                        <span style="font-size:0.9rem; color:var(--text-muted, #666);">
                                            {{ chk.description or "‚Äî" }}
                                        </span>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>
            {% endfor %}
        </div>
    </section>

</div>

<!-- Script tabs + tema oscuro -->
<script>
  (function () {
      // ====== Dark mode (igual que en index.html) ======
      const toggle = document.getElementById('theme_toggle');
      const body   = document.body;

      const stored = window.localStorage.getItem('qa_theme');
      if (stored === 'dark') {
          body.classList.add('theme-dark');
          if (toggle) toggle.textContent = '‚òÄÔ∏è Light mode';
      }

      if (toggle) {
          toggle.addEventListener('click', function () {
              const isDark = body.classList.toggle('theme-dark');
              window.localStorage.setItem('qa_theme', isDark ? 'dark' : 'light');
              toggle.textContent = isDark ? '‚òÄÔ∏è Light mode' : 'üåô Dark mode';
          });
      }

      // ====== Tabs de secciones ======
      const tabButtons = document.querySelectorAll('.tab-btn');
      const sections   = document.querySelectorAll('.settings-section');

      function showSection(id) {
          sections.forEach(sec => {
              sec.style.display = (sec.id === id) ? '' : 'none';
          });
          tabButtons.forEach(btn => {
              if (btn.dataset.tabTarget === id) {
                  btn.classList.add('tab-btn-active');
              } else {
                  btn.classList.remove('tab-btn-active');
              }
          });
      }

      // Activar la primera secci√≥n por defecto
      if (sections.length > 0) {
          const firstId = sections[0].id;
          showSection(firstId);
      }

      tabButtons.forEach(btn => {
          btn.addEventListener('click', () => {
              const target = btn.dataset.tabTarget;
              if (target) showSection(target);
          });
      });
  })();
</script>

<script>
  (function () {
      const toggle = document.getElementById('theme_toggle');
      const body   = document.body;

      const stored = window.localStorage.getItem('qa_theme');
      if (stored === 'dark') {
          body.classList.add('theme-dark');
          if (toggle) toggle.textContent = '‚òÄÔ∏è Light mode';
      }

      if (toggle) {
          toggle.addEventListener('click', function () {
              const isDark = body.classList.toggle('theme-dark');
              window.localStorage.setItem('qa_theme', isDark ? 'dark' : 'light');
              toggle.textContent = isDark ? '‚òÄÔ∏è Light mode' : 'üåô Dark mode';
          });
      }
  })();
</script>


</body>
</html>
